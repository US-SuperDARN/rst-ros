#!/bin/bash

east='cve'
west='cvw'

# dummy radar server
radar &

# critical tasks

echo "Waiting for errlog to start"
errlog -name ${east}.a -lp 41000 &
errlog -name ${east}.b -lp 42000 &
errlog -name ${west}.a -lp 51000 &
errlog -name ${west}.b -lp 52000 &
sleep 1

echo "Waiting for shellserver to start"
shellserver -sh RadarShellAa -cp 41001 -sp 45001 -ep 41000 &
shellserver -sh RadarShellAb -cp 42001 -sp 46001 -ep 42000 &
shellserver -sh RadarShellBa -cp 51001 -sp 55001 -ep 51000 &
shellserver -sh RadarShellBb -cp 52001 -sp 56001 -ep 52000 &
sleep 1

# support tasks

echo "Waiting for iqwrite to start"
iqwrite -lp 41101 -ep 41000 -c a &
iqwrite -lp 42101 -ep 42000 -c b &
iqwrite -lp 51101 -ep 51000 -c a &
iqwrite -lp 52101 -ep 52000 -c b &

echo "Waiting for rawacfwrite to start"
rawacfwrite -lp 41102 -ep 41000 -c a &
rawacfwrite -lp 42102 -ep 42000 -c b &
rawacfwrite -lp 51102 -ep 51000 -c a &
rawacfwrite -lp 52102 -ep 52000 -c b &

echo "Waiting for fitacfwrite to start"
fitacfwrite -lp 41103 -ep 41000 -c a &
fitacfwrite -lp 42103 -ep 42000 -c b &
fitacfwrite -lp 51103 -ep 51000 -c a &
fitacfwrite -lp 52103 -ep 52000 -c b &

sleep 2

echo "Waiting for rtserver to start"
rtserver -rp 41104 -ep 41000 -tp 1024 &
rtserver -rp 42104 -ep 42000 -tp 1025 &
sleep 2
rtserver -rp 51104 -ep 51000 -tp 1026 &
rtserver -rp 52104 -ep 52000 -tp 1027 &
sleep 2

echo "Starting scheduler"
schedule -name ${east}.a /data/ros/scd/${east}.a.scd &
schedule -name ${east}.b /data/ros/scd/${east}.b.scd &
sleep 2
schedule -name ${west}.a /data/ros/scd/${west}.a.scd &
schedule -name ${west}.b /data/ros/scd/${west}.b.scd &
